# Story 02.01: View Seat Availability

- **Status**: Done
- **Epic**: Core Booking Functionality

## Story

**As an** employee,
**I want** to view available seats for any future date,
**so that** I can plan my office visit.

## Acceptance Criteria

1. The user can select any future date from a calendar interface.
2. Upon selecting a date, the system displays the number of available seats for that day.
3. The availability information is fetched from the backend in real-time.
4. Past dates are disabled in the calendar and cannot be selected.
5. The interface clearly indicates if a day is fully booked.

## Tasks / Subtasks

- [ ] **Frontend:**
  - [ ] Connect the calendar component's date selection event to an API call.
  - [ ] Create a UI element to display the number of available seats.
  - [ ] Handle loading and error states for the availability data.
  - [ ] Ensure the calendar component disables past dates.
- [ ] **Backend:**
  - [ ] Create a new API endpoint `GET /api/seatbooking/availability?date=YYYY-MM-DD`.
  - [ ] The endpoint should calculate the number of available seats for the given date by taking the total capacity and subtracting the number of bookings.
  - [ ] The calculation must account for default capacity and any date-specific overrides.

## Dev Notes

- **API Endpoint:** `GET /api/seatbooking/availability`
- **Database Collections:**
  - `seatConfigurations`: To get the default seat count.
  - `daySeatOverrides`: To check for any capacity overrides for the selected date.
  - `bookings`: To count the number of existing bookings for that date.
- **Frontend State:** The frontend needs to manage the state for the selected date, loading status, and availability data.
- **Relevant Files:**
  - `apps/swivel-portal/src/pages/SeatBooking.tsx`
  - `apps/swivel-portal-api/src/main.ts` (or wherever routes are defined)
  - `libs/dal/` (for database interaction logic)

### Testing

- **Unit Tests:**
  - Test the backend logic for calculating seat availability, including cases with and without overrides.
- **Integration Tests:**
  - Test the `GET /api/seatbooking/availability` endpoint to ensure it returns the correct data.
- **E2E Tests:**
  - Simulate a user selecting a date and verify that the correct availability is displayed.

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-10-08 | 1.0     | Initial draft | Bob (SM) |
