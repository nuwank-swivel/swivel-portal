# Story 2.3: Persistent Login

- **Status**: Draft
- **Epic**: User Authentication

## Story

**As a** user,
**I want** to remain authenticated across sessions,
**so that** I don't have to sign in every time I visit the portal.

## Acceptance Criteria

1. After a successful login, the user's session is persisted.
2. When the user closes and reopens the browser, they are still logged in.
3. The application automatically refreshes the authentication token in the background before it expires.
4. The user is logged out only when they explicitly click the "Logout" button or their session expires after a long period of inactivity.

## Tasks / Subtasks

- [ ] **Frontend:**
  - [ ] Configure `msal-react` to use `localStorage` for token caching to persist the session across browser tabs and sessions.
  - [ ] Implement silent token acquisition to refresh tokens without user interaction.
  - [ ] Add a "Logout" button to the UI.
  - [ ] Implement the logout functionality, ensuring all session data is cleared from the client.

## Dev Notes

- **Token Caching:** `msal-react` handles most of the token caching and silent refresh logic. The key is to configure it correctly.
- **Cache Location:** Use `localStorage` for the MSAL cache to ensure persistence across browser sessions.
- **Silent Refresh:** The `acquireTokenSilent` method from MSAL should be used to get a valid token before making API calls. This will handle token refreshes automatically.
- **Relevant Files:**
  - `apps/swivel-portal/src/main.tsx` (for MSAL configuration)
  - `apps/swivel-portal/src/hooks/useApi.ts` (or similar, for implementing silent token acquisition before API calls)

### Testing

- **Manual Testing:**
  - Log in, close the browser, reopen it, and verify that the user is still logged in.
  - Leave the application open for an extended period to ensure the token refresh mechanism works as expected.
  - Test the logout functionality.

## Change Log

| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-10-08 | 1.0 | Initial draft | Bob (SM) |
