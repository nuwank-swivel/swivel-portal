# Story 02.04: Single Booking Per Day (No S### Testing

## File List

- Modified `/libs/domain/src/booking/bookSeat.ts`
  - Removed seat ID from booking function
  - Added user booking date check
  - Updated error messages
- Modified `/libs/dal/src/repositories/BookingRepository.ts`
  - Added hasUserBookingOnDate method
  - Removed seat-related methods
  - Updated types
- Modified `/libs/types/src/repository.ts`
  - Updated BookingRepository interface
- Modified `/libs/types/src/domain.ts`
  - Removed seatId from Booking interface
- Modified `/libs/dal/src/models/Booking.ts`
  - Removed seatId from mongoose schema

### Testings\*\*: Approved

- **Epic**: Core Booking Functionality

## Story

**As an** employee,
**I want** to be able to book a seat for a day without selecting a specific seat,
**so that** I can reserve my spot if seats are available, and not double-book for the same day.

## Acceptance Criteria

1. The user can create a booking for a specific day if seats are available.
2. The user cannot create more than one booking for the same day.
3. The booking process does not require selecting a seat ID.
4. If no seats are available for a day, the user cannot create a booking for that day.
5. The system prevents double-booking for the same user and day.

## Tasks / Subtasks

- [x] **Frontend:**
  - [x] Update the booking UI to remove seat selection.
  - [x] Ensure the booking form only allows one booking per user per day.
  - [x] Display appropriate messages if the user tries to book more than once for the same day.
- [x] **Backend:**
  - [x] Update the booking creation endpoint to enforce one booking per user per day.
  - [x] Remove seat ID from the booking data model and API.
  - [x] Return an error if a user attempts to book more than once for the same day.

## Dev Notes

- **API Endpoints:**
  - `POST /api/seatbooking/bookings` (enforce one booking per user per day, no seat ID)
  - `GET /api/seatbooking/bookings/me`
- **Data Model:**
  - Remove seat ID from booking model.
- **State Management:**
  - Ensure frontend state reflects the new booking rules.
- **Relevant Files:**
  - `apps/swivel-portal/src/pages/BookSeat.tsx` (or similar)
  - `apps/swivel-portal-api/`

## File List

- Modified `/libs/domain/src/booking/bookSeat.ts`
  - Removed seat ID from booking function
  - Added user booking date check
  - Updated error messages
- Modified `/libs/dal/src/repositories/BookingRepository.ts`
  - Added hasUserBookingOnDate method
  - Removed seat-related methods
  - Updated types
- Modified `/libs/types/src/repository.ts`
  - Updated BookingRepository interface
- Modified `/libs/types/src/domain.ts`
  - Removed seatId from Booking interface
- Modified `/libs/dal/src/models/Booking.ts`
  - Removed seatId from mongoose schema

### Testing

- **Unit Tests:**
  - Test backend logic for enforcing one booking per user per day.
- **Integration Tests:**
  - Test booking creation and prevention of double-booking.
- **E2E Tests:**
  - Simulate a user booking for a day, then attempting to book again for the same day.

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-10-14 | 1.0     | Initial draft | Bob (SM) |
