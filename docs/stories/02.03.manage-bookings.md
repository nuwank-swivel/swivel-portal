# Story 02.03: Manage Bookings (No Seat IDs)

- **Status**: Draft
- **Epic**: Core Booking Functionality

## Story

**As an** employee,
**I want** to view and cancel my daily bookings (without selecting a specific seat),
**so that** I can manage my reservations when seats are available.

## Acceptance Criteria

1. The user can see a list of their upcoming bookings (one per day).
2. Each booking in the list displays the date, duration, and other relevant details (no seat ID).
3. The user has the option to cancel any of their upcoming bookings.
4. When a booking is canceled, it is removed from the user's list and the seat for that day becomes available again.
5. The user cannot cancel past bookings.
6. The user can only create one booking per day if seats are available (no double-booking for the same day).

## Tasks / Subtasks

- [x] **Frontend:**
  - [x] Create a new component to display the user's bookings (one per day, no seat ID).
  - [x] Fetch the user's bookings from the backend and display them.
  - [x] Add a "Cancel" button to each booking.
  - [x] Implement the logic to call the delete endpoint when the "Cancel" button is clicked.
  - [x] After a successful cancellation, the booking list and the availability for that date should be updated.
- [x] **Backend:**
  - [x] Create an API endpoint `GET /api/seatbooking/bookings/me` to fetch the bookings for the authenticated user (one per day, no seat ID).
  - [x] Create an API endpoint `DELETE /api/seatbooking/bookings/{id}` to cancel a booking.
  - [x] The delete endpoint should verify that the user attempting to cancel the booking is the one who created it.
  - [x] The endpoint should not allow the cancellation of bookings for past dates.
  - [x] Ensure the backend enforces only one booking per user per day (no seat ID).

## Dev Notes

- **API Endpoints:**
  - `GET /api/seatbooking/bookings/me`
  - `DELETE /api/seatbooking/bookings/{id}`
  - `POST /api/seatbooking/bookings` (enforce one booking per user per day, no seat ID)
- **Data Display:** The list of bookings should be clear and easy to read. Consider a card-based layout for each booking.
- **State Management:** The frontend will need to manage the state of the user's bookings and update it after a cancellation.
- **Relevant Files:**
  - `apps/swivel-portal/src/pages/MyBookings.tsx` (or similar)
  - `apps/swivel-portal-api/`

### Testing

- **Unit Tests:**
  - Test the backend logic for the delete endpoint, including ownership and date checks.
  - Test the backend logic for enforcing only one booking per user per day.
- **Integration Tests:**
  - Test the `GET /api/seatbooking/bookings/me`, `POST /api/seatbooking/bookings`, and `DELETE /api/seatbooking/bookings/{id}` endpoints.
- **E2E Tests:**
  - Simulate a user viewing their bookings and canceling one. Verify that the UI updates correctly.

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-10-08 | 1.0     | Initial draft | Bob (SM) |
