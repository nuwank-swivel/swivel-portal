# Story 01.02: Admin Authorization

- **Status**: Draft
- **Epic**: User Authentication

## Story

**As an** admin,
**I want** to access protected admin features,
**so that** I can manage the office seating capacity.

## Acceptance Criteria

1.  When an admin user logs in, they have access to admin-specific controls.
2.  Admin controls are not visible to non-admin users.
3.  Access to admin API endpoints is restricted to users with the 'Admin' role.
4.  The user's role is determined by the custom Lambda authorizer based on their Azure AD group membership.

## Tasks / Subtasks

- [ ] **Frontend:**
  - [ ] Implement logic to check the user's role from the session information received after login.
  - [ ] Conditionally render admin-specific UI components (e.g., "Edit Capacity" button) based on the user's role.
- [ ] **Backend:**
  - [ ] Enhance the custom Lambda authorizer to check for Azure AD group membership from the validated token.
  - [ ] The authorizer should attach the user's role to the request context.
  - [ ] Protect admin-specific API Gateway endpoints, allowing access only for requests with an 'Admin' role in the context.
  - [ ] Define an 'Admin' role and the corresponding Azure AD group ID in the backend configuration.

## Dev Notes

- **Authorization:** Role-Based Access Control (RBAC) will be implemented by the custom Lambda authorizer.
- **Admin Identification:** Users will be identified as admins based on their membership in a specific Azure AD group. The ID of this group should be stored in the backend configuration (e.g., SSM Parameter Store).
- **Token Claims:** The user's roles or group memberships should be included as claims in the JWT after authentication.
- **Relevant Files:**
  - `infra/lib/swivel-portal-stack.ts` (for configuring the authorizer and protected routes)
  - `apps/swivel-portal/src/components/booking/BookingModal.tsx` (example of where conditional UI will be needed)

### Testing

- **Unit Tests:**
  - Test the role-checking logic on the frontend.
  - Test that admin components are hidden for non-admin users.
- **Integration Tests:**
  - Test that API endpoints for admin features return 403 Forbidden for non-admin users.
  - Test that an admin user can successfully access admin features and API endpoints.

## Change Log

| Date       | Version | Description   | Author   |
| ---------- | ------- | ------------- | -------- |
| 2025-10-08 | 1.0     | Initial draft | Bob (SM) |
