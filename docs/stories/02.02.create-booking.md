# Story 3.2: Create Booking

- **Status**: Approved
- **Epic**: Core Booking Functionality

## Story

**As an** employee,
**I want** to book a seat for various durations,
**so that** I can reserve a workspace for the time I need.

## Acceptance Criteria

1. The user can open a booking modal after selecting a date.
2. The modal allows the user to select a booking duration (e.g., 1 hour, half-day, full-day).
3. The user can select a lunch option.
4. The system prevents booking if no seats are available for the selected date.
5. Upon successful booking, the user receives a confirmation message.
6. The booking is saved to the database.

## Tasks / Subtasks

- [x] **Frontend:**
  - [ ] Implement the "Book a seat" button, which should be disabled if no seats are available.
  - [x] Connect the booking modal's form to an API call.
  - [x] The form should include fields for duration and lunch option.
  - [x] Handle the API response, showing a success or error message to the user.
  - [ ] After a successful booking, the availability display should be updated.
- [x] **Backend:**
  - [x] Create a new API endpoint `POST /api/seatbooking/bookings`.
  - [x] The endpoint should validate the incoming booking request (e.g., check if the date is in the future, if seats are available).
  - [x] The endpoint should perform the booking operation in a transaction to prevent race conditions and double-bookings.
  - [x] The new booking should be saved in the `bookings` collection.

## Dev Notes

- **API Endpoint:** `POST /api/seatbooking/bookings`
- **Request Body:**
  ```json
  {
    "date": "YYYY-MM-DD",
    "duration": "full-day",
    "lunchOption": "Packed Lunch"
  }
  ```
- **Concurrency:** The backend must handle concurrent requests gracefully to avoid overbooking. A database transaction is recommended.
- **Relevant Files:**
  - `apps/swivel-portal/src/components/booking/BookingModal.tsx`
  - `apps/swivel-portal-api/`
  - `libs/dal/`
  - `libs/domain/`

### Testing

- **Unit Tests:**
  - Test the form validation on the frontend.
  - Test the backend validation logic for booking requests.
- **Integration Tests:**
  - Test the `POST /api/seatbooking/bookings` endpoint.
  - Test the case where a user tries to book a seat on a fully booked day.
- **E2E Tests:**
  - Simulate the full booking process from selecting a date to confirming the booking.

## Change Log

| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-10-08 | 1.0 | Initial draft | Bob (SM) |
